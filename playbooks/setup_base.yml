---
- name: Setup Base System Configuration
  hosts: all
  become: true
  roles:
    - role: devsec.hardening.os_hardening
      vars:
        # Only enable user/group management
        os_hardening_enabled: true
        manage_users: true
        manage_groups: true
        sysctl_overwrite:
          # Enable IPv4 traffic forwarding for Docker
          net.ipv4.ip_forward: 1

        # SSH Hardening
        ssh_permit_root_login: "without-password"
        ssh_allow_users: ["root"]
        ssh_client_password_login: false
        ssh_server_password_login: false
        ssh_use_pam: true

    - role: geerlingguy.docker
      vars:
        docker_install_compose_plugin: true
        docker_users: "{{ os_users | map(attribute='name') | list }}"  # Add users to docker group
